(window.webpackJsonp=window.webpackJsonp||[]).push([[24],{438:function(t,e,a){"use strict";a.r(e);var n=a(2),s=Object(n.a)({},(function(){var t=this,e=t._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h2",{attrs:{id:"wx-requestpayment-object-object"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#wx-requestpayment-object-object"}},[t._v("#")]),t._v(" wx.requestPayment(Object object)")]),t._v(" "),e("h2",{attrs:{id:"参数"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#参数"}},[t._v("#")]),t._v(" 参数")]),t._v(" "),e("table",[e("thead",[e("tr",[e("th",{staticStyle:{"text-align":"center"}},[t._v("属性")]),t._v(" "),e("th",{staticStyle:{"text-align":"center"}},[t._v("类型")]),t._v(" "),e("th",{staticStyle:{"text-align":"center"}},[t._v("默认值")]),t._v(" "),e("th",{staticStyle:{"text-align":"center"}},[t._v("必填")]),t._v(" "),e("th",{staticStyle:{"text-align":"center"}},[t._v("说明")])])]),t._v(" "),e("tbody",[e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("timeStamp")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("string")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}}),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("是")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("时间戳，从 1970 年 1 月 1 日 00:00:00 至今的秒数，即当前的时间")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("nonceStr")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("string")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}}),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("是")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("随机字符串，长度为32个字符以下")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("package")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("string")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}}),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("是")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("统一下单接口返回的 prepay_id 参数值，提交格式如：prepay_id=***")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("signType")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("string")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("MD5(其它HMAC-SHA256、RSA)")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("否")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("签名算法，应与后台下单时的值一致")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("paySign")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("string")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}}),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("是")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("签名，具体见微信支付文档")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("success")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("function")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}}),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("否")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("接口调用成功的回调函数")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("fail")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("function")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}}),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("否")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("接口调用失败的回调函数")])]),t._v(" "),e("tr",[e("td",{staticStyle:{"text-align":"center"}},[t._v("complete")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("function")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}}),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("否")]),t._v(" "),e("td",{staticStyle:{"text-align":"center"}},[t._v("接口调用结束的回调函数（调用成功、失败都会执行）")])])])]),t._v(" "),e("h3",{attrs:{id:"实例代码"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#实例代码"}},[t._v("#")]),t._v(" 实例代码")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v("wx.requestPayment({\n  timeStamp: '',\n  nonceStr: '',\n  package: '',\n  signType: 'MD5',\n  paySign: '',\n  success (res) { },\n  fail (res) { }\n})\n")])])]),e("p",[t._v("注：如果服务端有使用云开发，可以通过云开发微信支付"),e("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/open/pay/CloudPay.unifiedOrder.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("统一下单"),e("OutboundLink")],1),t._v("接口免鉴权获取以上所需所有参数，示例：")]),t._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[t._v('// 云函数代码\nconst cloud = require(\'wx-server-sdk\')\ncloud.init({\n  env: cloud.DYNAMIC_CURRENT_ENV\n})\n\nexports.main = async (event, context) => {\n  const res = await cloud.cloudPay.unifiedOrder({\n    "body" : "小秋TIT店-超市",\n    "outTradeNo" : "1217752501201407033233368018",\n    "spbillCreateIp" : "127.0.0.1",\n    "subMchId" : "1900009231",\n    "totalFee" : 1,\n    "envId": "test-f0b102",\n    "functionName": "pay_cb"\n  })\n  return res\n}\n\n// 小程序代码\nwx.cloud.callFunction({\n  name: \'函数名\',\n  data: {\n    // ...\n  },\n  success: res => {\n    const payment = res.result.payment\n    wx.requestPayment({\n      ...payment,\n      success (res) {\n        console.log(\'pay success\', res)\n      },\n      fail (err) {\n        console.error(\'pay fail\', err)\n      }\n    })\n  },\n  fail: console.error,\n})\n')])])]),e("h3",{attrs:{id:"简述微信支付的业务流程"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#简述微信支付的业务流程"}},[t._v("#")]),t._v(" 简述微信支付的业务流程")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("步骤1：用户在商户APP中选择商品，提交订单，选择微信支付。")])]),t._v(" "),e("li",[e("p",[t._v("步骤2：商户后台收到用户支付单，调用微信支付统一下单接口。参见"),e("a",{attrs:{href:"https://pay.weixin.qq.com/wiki/doc/api/app/app.php?chapter=9_1",target:"_blank",rel:"noopener noreferrer"}},[t._v("统一下单API"),e("OutboundLink")],1),t._v("。")])]),t._v(" "),e("li",[e("p",[t._v("步骤3：统一下单接口返回正常的prepay_id，再按签名规范重新生成签名后，将数据传输给APP。参与签名的字段名为"),e("code",[t._v("appid")]),t._v("，"),e("code",[t._v("partnerid")]),t._v("，"),e("code",[t._v("prepayid")]),t._v("，"),e("code",[t._v("noncestr")]),t._v("，"),e("code",[t._v("timestamp")]),t._v("，"),e("code",[t._v("package")]),t._v("。注意：package的值格式为"),e("code",[t._v("Sign=WXPay")])])]),t._v(" "),e("li",[e("p",[t._v("步骤4：商户APP调起微信支付。")]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[t._v("wx"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("requestPayment")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("timeStamp")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("nonceStr")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("package")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("signType")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'MD5'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("paySign")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("success")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("res")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("fail")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("res")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])]),t._v(" "),e("li",[e("p",[t._v("步骤5：商户后台接收支付通知。"),e("code",[t._v("api")]),t._v("参见"),e("a",{attrs:{href:"https://pay.weixin.qq.com/wiki/doc/api/app/app.php?chapter=9_7",target:"_blank",rel:"noopener noreferrer"}},[t._v("支付结果通知API"),e("OutboundLink")],1)])]),t._v(" "),e("li",[e("p",[t._v("步骤6：商户后台查询支付结果。，"),e("code",[t._v("api")]),t._v("参见"),e("a",{attrs:{href:"https://pay.weixin.qq.com/wiki/doc/api/app/app.php?chapter=9_2",target:"_blank",rel:"noopener noreferrer"}},[t._v("查询订单API"),e("OutboundLink")],1),t._v("（查单实现可参考："),e("a",{attrs:{href:"https://pay.weixin.qq.com/wiki/doc/api/app/app.php?chapter=23_9&index=1",target:"_blank",rel:"noopener noreferrer"}},[t._v("支付回调和查单实现指引"),e("OutboundLink")],1),t._v("） 详情参考[这里]")])])])])}),[],!1,null,null,null);e.default=s.exports}}]);